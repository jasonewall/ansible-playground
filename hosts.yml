all:
  hosts:
    ansible-playground:
      ansible_port: 2222
      ansible_host: 127.0.0.1
      ansible_user: vagrant
      ansible_ssh_private_key_file: ./.vagrant/machines/default/virtualbox/private_key
      stats_ip: '192.168.50.50'
      keepalived_vrrp_scripts:
        chk_haproxy:
          script: '/usr/bin/pgrep haproxy'
          weight: 2
          interval: 1
      keepalived_vrrp_instances:
        VI_1:
          interface: enp0s8
          state: MASTER
          priority: 101
          virtual_router_id: 51

          authentication:
            auth_type: PASS
            auth_pass: '4Apr3C*d'

          virtual_ipaddresses:
            - '192.168.50.50'

          track_scripts:
            - chk_haproxy

  children:
    load-balancers:
      hosts:
        ansible-playground:
      vars:
        haproxy_listen:
          - name: 'stats'
            bind:
              - listen: "{{ hostvars[inventory_hostname]['stats_ip'] }}:9090"
            mode: http
            stats:
              enable: true

        haproxy_frontend:
          - name: measure_admin
            bind:
              - listen: "0.0.0.0:80"
            default_backend: admin_nginx
            mode: http

        haproxy_backend:
          - name: admin_nginx
            balance: roundrobin
            mode: http
            option:
              - httpchk GET /healthcheck
            http_request:
              - action: set-header Host yardstickadmin.com
            server:
              - name: admin1
                listen: "192.168.2.184:80"
                param:
                  - check
                  - slowstart 10s
                  - maxconn 16000
                  - inter 5s
                  - fastinter 500ms
                  - downinter 5s
              - name: admin2
                listen: "192.168.2.180:80"
                param:
                  - check
                  - slowstart 10s
                  - maxconn 16000
                  - inter 5s
                  - fastinter 500ms
                  - downinter 5s
