- hosts: ansible-playground
  become: yes
  become_user: root
  become_method: sudo
  roles:
    - role: haproxy
      haproxy_version: '1.8'
      vars:
        haproxy_listen:
          - name: 'stats'
            bind:
              - listen: "0.0.0.0:9090"
            mode: http
            stats:
              enable: true

        haproxy_frontend:
          - name: measure_admin
            bind:
              - listen: "0.0.0.0:80"
            default_backend: admin_nginx
            mode: http

        haproxy_backend:
          - name: admin_nginx
            balance: roundrobin
            mode: http
            option:
              - httpchk GET /healthcheck
            http_request:
              - action: set-header Host yardstickadmin.com
            server:
              - name: admin1
                listen: "192.168.2.184:80"
                param:
                  - check
                  - slowstart 10s
                  - maxconn 16000
                  - inter 5s
                  - fastinter 500ms
                  - downinter 5s
              - name: admin2
                listen: "192.168.2.180:80"
                param:
                  - check
                  - slowstart 10s
                  - maxconn 16000
                  - inter 5s
                  - fastinter 500ms
                  - downinter 5s
